<Byteblazar>

	<append xpath="/buffs">
		<buff name="bbxfx_buffWeaponFlash" hidden="true">
		<stack_type value="replace"/>
		<duration value=".02"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Bright"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade=".02" effect_name="Bright"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".25" fade="0" effect_name="Singularity_Overlay"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="0" fade=".02" effect_name="Singularity_Overlay"/>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffGeneralExplosiveBuff" hidden="true">
		<stack_type value="replace"/>
		<duration value=".11"/>
			<requirement_group op="and">
				<requirement name="!HasBuff" buff="god"/>
				<requirement name="EntityTagCompare" tags="player"/>
			</requirement_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="Ragdoll" duration=".2" force="600"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="bbxfxTriggeredByExplosive" operation="add" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" fireOneBuff="false" buff="buffInjuryStunned01,buffArmBroken,buffLegBroken,buffInjuryConcussion,bbxfx_buffDeafness" weights="0.35,0.1,0.125,0.325,0.375"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="bbxfxTriggeredByExplosive" operation="add" value="-1"/>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffDeafness" remove_on_death="true" hidden="true">
		<stack_type value="replace"/>
		<duration value="0"/>
			<effect_group>
				<passive_effect name="BuffBlink" operation="base_add" duration="0,1.3" value="2" tags="bbxfx_buffDeafness"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bbxfxDeafnessTimer" operation="set" value="60"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bbxfx_buffDeafnessShortIndicator"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$bbxfxDeafnessTimer" operation="set" value="600"/>
				<triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="bbxfx_buffDeafnessGetsWorse"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bbxfxDeafnessTimer" operation="add" value="-1"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bbxfx_buffDeafness">
					<requirement name="CVarCompare" cvar="$bbxfxDeafnessTimer" operation="LT" value="1"/>
				</triggered_effect>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfEnteredGame" action="SetAudioMixerState" state="Deafened" enabled="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Deafened" enabled="true"/>
				<triggered_effect trigger="onSelfBuffRemove" action="SetAudioMixerState" state="Deafened" enabled="false"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bbxfx_buffDeafnessShortIndicator,bbxfx_buffDeafnessLongIndicator"/>
				<!-- <triggered_effect trigger="onSelfBuffStart"  action="AddBuff" buff="bbxfx_buffDeafnessBlinking"/> -->
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="$bbxfx_buffDeafness">
					<requirement name="HasBuff" buff="god"/>
				</triggered_effect>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffDeafnessGetsWorse" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1.3"/>

			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bbxfx_buffDeafnessShortIndicator"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bbxfx_buffDeafnessLongIndicator"/>
				<passive_effect name="BuffBlink" operation="base_add" value="2" tags="bbxfx_buffDeafnessLongIndicator"/>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffDeafnessShortIndicator" name_key="bbxfxBuffDeafness" description_key="bbxfxBuffDeafnessDesc" tooltip_key="bbxfxBuffDeafnessTooltip" icon="bbxfxdeafness"  icon_color="255,128,0"  remove_on_death="true">
		<stack_type value="ignore"/>
		<display_value value="$bbxfxDeafnessTimer"/>
		<display_value_format value="time"/>
		<duration value="0"/>
		</buff>
		
		<buff name="bbxfx_buffDeafnessLongIndicator" name_key="bbxfxBuffDeafness" description_key="bbxfxBuffDeafnessDesc" tooltip_key="bbxfxBuffDeafnessTooltip" icon="bbxfxdeafness"  icon_color="255,0,0"  remove_on_death="true">
		<stack_type value="ignore"/>
		<display_value value="$bbxfxDeafnessTimer"/>
		<display_value_format value="time"/>
		<duration value="0"/>
		</buff>
		
		<!-- <buff name="bbxfx_buffDeafnessBlinking" hidden="true"> -->
			<!-- <stack_type value="ignore"/> -->
			<!-- <duration value="3"/> -->
			<!-- <effect_group> -->
				<!-- <passive_effect name="BuffBlink" operation="base_add" value="2" tags="bbxfx_buffDeafness"/> -->
			<!-- </effect_group> -->
		<!-- </buff> -->
		
		<buff name="bbxfx_buffFlashbangNonPlayer" hidden="true">
		<stack_type value="replace"/>
		<duration value="6"/>
			<requirement_group op="and">
				<requirement name="!EntityTagCompare" tags="player"/>
			</requirement_group>
			
			<effect_group>
				<passive_effect name="RunSpeed" operation="perc_set" value="0" />
				<passive_effect name="WalkSpeed" operation="perc_set" value="0" />
				<passive_effect name="CrouchSpeed" operation="perc_set" value="0" />
				<passive_effect name="JumpStrength" operation="perc_set" value="0" />
				<passive_effect name="AttacksPerMinute" operation="perc_set" value=".2" />
				<triggered_effect trigger="onSelfBuffRemove" action="AddBuff" buff="bbxfx_buff5sSlow"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="Singularity_Stunned" operation="add" value="1"/>
			</effect_group>
		</buff>
		<buff name="bbxfx_buff5sSlow" hidden="true">
		<stack_type value="replace"/>
		<duration value="5"/>
			<requirement_group op="and">
				<requirement name="!EntityTagCompare" tags="player"/>
			</requirement_group>
			
			<effect_group name="nonplayers">
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="Singularity_Stunned" operation="add" value="-1"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="Singularity_Stunned" operation="add" value="-1"/>
				<passive_effect name="RunSpeed" operation="perc_add" value="-50"/>
				<passive_effect name="WalkSpeed" operation="perc_add" value="-50"/>
				<passive_effect name="CrouchSpeed" operation="perc_add" value="-50"/>
				<passive_effect name="JumpStrength" operation="perc_add" value="-50"/>
				<passive_effect name="AttacksPerMinute" operation="perc_add" value="-50"/>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffFlashbang" hidden="true">
		<stack_type value="replace"/>
		<duration value="0"/>
		<update_rate value=".1"/>
			<requirement_group op="and">
				<requirement name="!HasBuff" buff="god"/>
				<requirement name="EntityTagCompare" tags="player"/>
			</requirement_group>
		
			<effect_group>
				<!-- startup -->
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bbxfx_ringingEars" play_in_head="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="bbxfxTriggeredByExplosive" operation="add" value="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" fireOneBuff="false" buff="buffInjuryConcussion,bbxfx_buffDeafness" weights="0.1,0.15"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="bbxfx_buffFlashbangVFX"/>
				<triggered_effect trigger="onSelfBuffStack" action="AddBuff" buff="bbxfx_buffFlashbangVFX"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$bbxfxFlashbangTimer" operation="set" value="100"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyCVar" cvar="$bbxfxFlashbangTimer" operation="set" value="100"/>
				<triggered_effect trigger="onSelfBuffStart" action="SetAudioMixerState" state="Stunned" enabled="true"/>
				<triggered_effect trigger="onSelfEnteredGame" action="SetAudioMixerState" state="Stunned" enabled="true"/>
				<triggered_effect trigger="onSelfBuffStart" action="ShakeCamera" shake_speed="0.1" shake_amplitude="360" shake_time="-1"/>
			</effect_group>
			<effect_group>
				<!-- counter -->
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bbxfx_buffFlashbang">
					<requirement name="CVarCompare" cvar="$bbxfxFlashbangTimer" operation="LT" value="1"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$bbxfxFlashbangTimer" operation="add" value="-1"/>
			</effect_group>
			<effect_group>
			<effect_group>
				<!-- 0.1 seconds in -->
				<requirement name="CVarCompare" cvar="$bbxfxFlashbangTimer" operation="Equals" value="99"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="bbxfxTriggeredByExplosive" operation="add" value="-1">
					<requirement name="CVarCompare" cvar="bbxfxTriggeredByExplosive" operation="GT" value="0"/>
				</triggered_effect>
			</effect_group>
				<!-- constant effects -->
				<passive_effect name="RunSpeed" operation="perc_add" value="-90"/>
				<passive_effect name="WalkSpeed" operation="perc_add" value="-90"/>
				<passive_effect name="CrouchSpeed" operation="perc_add" value="-90"/>
				<passive_effect name="JumpStrength" operation="perc_add" value="-90"/>
				<passive_effect name="AttacksPerMinute" operation="perc_add" value="-50" />
				<triggered_effect trigger="onSelfBuffUpdate" action="ShakeCamera" shake_speed="0.1" shake_amplitude="360" shake_time="-1"/>
			</effect_group>
			<effect_group>
				<!-- cleanup -->
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bbxfx_buffFlashbang">
					<requirement name="HasBuff" buff="god"/>
				</triggered_effect>
				<triggered_effect trigger="onSelfBuffRemove" action="FadeOutSound" sound="bbxfx_ringingEars" play_in_head="true"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveCVar" cvar="$bbxfxFlashbangTimer"/>
				<triggered_effect trigger="onSelfBuffRemove" action="RemoveBuff" buff="bbxfx_buffFlashbangVFX"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ShakeCamera" shake_speed="0" shake_amplitude="0" shake_time="1"/>
				<triggered_effect trigger="onSelfBuffRemove" action="SetAudioMixerState" state="Stunned" enabled="false"/>
				<triggered_effect trigger="onSelfLeaveGame" action="StopSound" sound="bbxfx_ringingEars" play_in_head="true"/>
			</effect_group>
		</buff>
		
		<buff name="bbxfx_buffFlashbangVFX" hidden="true">
		<stack_type value="replace"/>
		<duration value="0"/>
		<update_rate value=".1"/>
			<requirement_group op="and">
				<requirement name="!HasBuff" buff="god"/>
				<requirement name="EntityTagCompare" tags="player"/>
			</requirement_group>
		
			<effect_group>
				<!-- start -->
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Dark"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Bright"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Hot"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Blur"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" intensity=".75" fade="0" effect_name="Greyscale"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Dark"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Bright"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Hot"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyScreenEffect" intensity="1" fade="0" effect_name="Blur"/>
				<triggered_effect trigger="onSelfBuffStack" action="ModifyScreenEffect" intensity=".75" fade="0" effect_name="Greyscale"/>
			</effect_group>
			<effect_group>
				<!-- 0.1 seconds in -->
				<requirement name="CVarCompare" cvar="$bbxfxFlashbangTimer" operation="Equals" value="99"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" fade="0" effect_name="Singularity_Snapshot"/>
				<triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" intensity=".5" fade="0" effect_name="Singularity_Overlay"/>
			</effect_group>
			<effect_group>
				<!-- 2 seconds in -->
				<triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="bbxfx_buffFlashbangVFX">
					<requirement name="CVarCompare" cvar="$bbxfxFlashbangTimer" operation="LTE" value="80"/>
				</triggered_effect>
				<!-- cleanup -->
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Singularity_Snapshot"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Singularity_Overlay"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Dark"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Bright"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="8" effect_name="Hot"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Blur"/>
				<triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" intensity="0" fade="13" effect_name="Greyscale"/>
			</effect_group>
		</buff>
	</append>
	
	<append xpath="/buffs/buff[@name='god']">
		<effect_group>
			<triggered_effect trigger="onSelfBuffStart" action="RemoveBuff" buff="bbxfx_buffGeneralExplosiveBuff,bbxfx_buffDeafness,bbxfx_buffFlashbangS3"/>
		</effect_group>
	</append>
		
	<prepend xpath="//triggered_effect[@action='AddBuff' and (@buff='buffOnAnyCrit')]">
		<requirement name="CVarCompare" cvar="bbxfxTriggeredByExplosive" operation="LT" value="1"/>
	</prepend>
	
	<prepend xpath="/buffs/buff[@name='buffStatusCheck01']">
		<effect_group>
			<triggered_effect trigger="onSelfAttackedOther" action="Ragdoll" duration="3.5" target="other">
				<requirement name="HoldingItemHasTags" target="self" tags="melee"/>
				<requirement name="CVarCompare" cvar="Singularity_Stunned" operation="GT" value="0" target="other"/>
				<requirement name="!HoldingItemBroken"/>
			</triggered_effect>
		</effect_group>
	</prepend>
	
	<prepend xpath="/buffs/buff[@name='buffDrowning03' or @name='buffIsOnFire']">
		<effect_group>
			<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="bbxfx_fastHeartbeat" play_in_head="true"/>
			<triggered_effect trigger="onSelfBuffRemove" action="FadeOutSound" sound="bbxfx_fastHeartbeat" play_in_head="true"/>
		</effect_group>
	</prepend>
	
	<conditional>
		<if cond="xpath('/buffs/buff[@name=&quot;buffBurnt_Storm&quot;]/effect_group/triggered_effect[@action=&quot;AddHealth&quot;]') != null">
			<setattribute xpath="/buffs/buff[@name='buffBurnt_Storm']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffDesert_Storm']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffSnow_Storm']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffWasteland_Storm']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
		</if>
	</conditional>
	
	<conditional>
		<if cond="xpath('/buffs/buff[@name=&quot;buffDesert_Storm_Stage02&quot;]/effect_group/triggered_effect[@action=&quot;AddHealth&quot;]') != null">
			<setattribute xpath="/buffs/buff[@name='buffBurnt_Storm_Stage02']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffDesert_Storm_Stage02']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffSnow_Storm_Stage02']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
			<setattribute xpath="/buffs/buff[@name='buffWasteland_Storm_Stage02']/effect_group/triggered_effect[@action='AddHealth']" name='show_splatter'>false</setattribute>
		</if>
	</conditional>

</Byteblazar>
